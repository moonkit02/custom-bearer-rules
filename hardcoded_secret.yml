rules:
  php_lang_hardcoded_secret:
    patterns:
      - pattern: |
          $$<NAME> = $<STRING_LITERAL>
        filters:
          - variable: NAME
            detection: php_lang_hardcoded_secret_name
          - variable: STRING_LITERAL
            detection: php_lang_hardcoded_secret_literal
      - pattern: |
          const $<NAME> = $<STRING_LITERAL>
        filters:
          - variable: NAME
            detection: php_lang_hardcoded_secret_name
          - variable: STRING_LITERAL
            detection: php_lang_hardcoded_secret_literal
      - pattern: |
          array($<NAME> => $<STRING_LITERAL>)
        filters:
          - variable: NAME
            detection: php_lang_hardcoded_secret_name_string
          - variable: STRING_LITERAL
            detection: php_lang_hardcoded_secret_literal
          - not:  # Excludes arrays inside $request->validate()
              pattern: |
                $<!REQUEST>->validate(array($<NAME> => $<STRING_LITERAL>))
              variables:
                REQUEST:
                  regex: \b(request|this)\b
      - pattern: |
          define($<NAME>, $<STRING_LITERAL>);
        filters:
          - variable: NAME
            detection: php_lang_hardcoded_secret_name_string
          - variable: STRING_LITERAL
            detection: php_lang_hardcoded_secret_literal
    auxiliary:
      - id: php_lang_hardcoded_secret_name
        patterns:
          - pattern: $<NAME>;
            filters:
              - variable: NAME
                regex: (?i)(password|api_?key|secret)\b
      - id: php_lang_hardcoded_secret_name_string
        patterns:
          - pattern: $<NAME>;
            filters:
              - variable: NAME
                string_regex: (?i)(password|api_?key|secret)\b
      - id: php_lang_hardcoded_secret_literal
        patterns:
          - pattern: $<STRING>;
            filters:
              - variable: STRING
                detection: string_literal
              - not:
                  variable: STRING
                  string_regex: \A[*â€¢]+\z
              - variable: STRING
                entropy_greater_than: 3
    languages:
      - php
    severity: critical
exclude:
  - bootstrap/cache/*  # Also excludes cache files to avoid other false positives
  - vendor/*           # Excludes Laravel dependencies
